(window.webpackJsonp=window.webpackJsonp||[]).push([[3,8],{217:function(t,e,n){"use strict";n.r(e),n.d(e,"default",function(){return p});var o=n(0),r=n.n(o),a=n(78);function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var f=r.a.Fragment,p=function(t){function e(t){var n,o,r,a;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),n=function(t,e){return!e||"object"!==i(e)&&"function"!=typeof e?l(t):e}(this,c(e).call(this,t)),o=l(n),a=function(){n.props.history.goBack()},(r="goBack")in o?Object.defineProperty(o,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):o[r]=a,n}var n,o,p;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}(e,r.a.Component),n=e,(o=[{key:"componentDidMount",value:function(){document.title="Your-Book-List/".concat(this.props.match.params.bookid)}},{key:"render",value:function(){return r.a.createElement(f,null,r.a.createElement("div",{className:"bookItem-backBtn"},r.a.createElement("button",{onClick:this.goBack},"Back")),r.a.createElement(a.default,{bookId:this.props.match.params.bookid}))}}])&&u(n.prototype,o),p&&u(n,p),e}()},35:function(t,e){t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},39:function(t,e,n){var o=n(71),r="object"==typeof self&&self&&self.Object===Object&&self,a=o||r||Function("return this")();t.exports=a},40:function(t,e,n){var o=n(39).Symbol;t.exports=o},59:function(t,e,n){var o=n(69),r=n(35),a="Expected a function";t.exports=function(t,e,n){var i=!0,u=!0;if("function"!=typeof t)throw new TypeError(a);return r(n)&&(i="leading"in n?!!n.leading:i,u="trailing"in n?!!n.trailing:u),o(t,e,{leading:i,maxWait:e,trailing:u})}},69:function(t,e,n){var o=n(35),r=n(70),a=n(72),i="Expected a function",u=Math.max,c=Math.min;t.exports=function(t,e,n){var l,s,f,p,d,b,m=0,y=!1,v=!1,h=!0;if("function"!=typeof t)throw new TypeError(i);function g(e){var n=l,o=s;return l=s=void 0,m=e,p=t.apply(o,n)}function k(t){var n=t-b;return void 0===b||n>=e||n<0||v&&t-m>=f}function w(){var t=r();if(k(t))return E(t);d=setTimeout(w,function(t){var n=e-(t-b);return v?c(n,f-(t-m)):n}(t))}function E(t){return d=void 0,h&&l?g(t):(l=s=void 0,p)}function j(){var t=r(),n=k(t);if(l=arguments,s=this,b=t,n){if(void 0===d)return function(t){return m=t,d=setTimeout(w,e),y?g(t):p}(b);if(v)return d=setTimeout(w,e),g(b)}return void 0===d&&(d=setTimeout(w,e)),p}return e=a(e)||0,o(n)&&(y=!!n.leading,f=(v="maxWait"in n)?u(a(n.maxWait)||0,e):f,h="trailing"in n?!!n.trailing:h),j.cancel=function(){void 0!==d&&clearTimeout(d),m=0,l=b=s=d=void 0},j.flush=function(){return void 0===d?p:E(r())},j}},70:function(t,e,n){var o=n(39);t.exports=function(){return o.Date.now()}},71:function(t,e,n){(function(e){var n="object"==typeof e&&e&&e.Object===Object&&e;t.exports=n}).call(this,n(13))},72:function(t,e,n){var o=n(35),r=n(73),a=NaN,i=/^\s+|\s+$/g,u=/^[-+]0x[0-9a-f]+$/i,c=/^0b[01]+$/i,l=/^0o[0-7]+$/i,s=parseInt;t.exports=function(t){if("number"==typeof t)return t;if(r(t))return a;if(o(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=o(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(i,"");var n=c.test(t);return n||l.test(t)?s(t.slice(2),n?2:8):u.test(t)?a:+t}},73:function(t,e,n){var o=n(74),r=n(77),a="[object Symbol]";t.exports=function(t){return"symbol"==typeof t||r(t)&&o(t)==a}},74:function(t,e,n){var o=n(40),r=n(75),a=n(76),i="[object Null]",u="[object Undefined]",c=o?o.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?u:i:c&&c in Object(t)?r(t):a(t)}},75:function(t,e,n){var o=n(40),r=Object.prototype,a=r.hasOwnProperty,i=r.toString,u=o?o.toStringTag:void 0;t.exports=function(t){var e=a.call(t,u),n=t[u];try{t[u]=void 0;var o=!0}catch(t){}var r=i.call(t);return o&&(e?t[u]=n:delete t[u]),r}},76:function(t,e){var n=Object.prototype.toString;t.exports=function(t){return n.call(t)}},77:function(t,e){t.exports=function(t){return null!=t&&"object"==typeof t}},78:function(t,e,n){"use strict";n.r(e);var o=n(0),r=n.n(o),a=n(9);function i(t,e,n){!function(t,e,n){fetch("https://gutenberg.justamouse.com/texts/".concat(e),{signal:t}).then(function(t){return t.ok?t.json():Promise.reject(t.status)}).then(function(t){if(!t.metadata.title)return Promise.reject(404);n(null,t)}).catch(function(t){n(t,null)})}(t,e,function(o,r){if(o)return n(o,null);!function(t,e,n){fetch("/api/booklist/".concat(e),{credentials:"same-origin",signal:t}).then(function(t){return t.ok?t.json():Promise.reject(t.status)}).then(function(t){n(null,t)}).catch(function(t){n(t,null)})}(t,e,function(t,e){return n(null,{bookData:r,userData:e})})})}function u(t,e,n,o){var r={method:t,credentials:"same-origin"};"DELETE"!=t&&(r.headers={"Content-Type":"application/json"},r.body=JSON.stringify({status:n}));var a="/api/booklist/".concat(e);fetch(a,r).then(function(t){return t.ok?t.json():Promise.reject(t.status)}).then(function(t){return o(null,t)}).catch(function(t){return o(t,null)})}var c=n(59),l=n.n(c);function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function f(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function d(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function b(t,e){return(b=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function m(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var y=r.a.Fragment,v=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),n=function(t,e){return!e||"object"!==s(e)&&"function"!=typeof e?d(t):e}(this,p(e).call(this,t)),m(d(n),"handleInput",function(t){n.setState({input:t.target.value})}),m(d(n),"buttonPress",function(t){var e=t.target.dataset.type;n.props.turnOffButton(),"add"==e?n.props.addBook(n.state.input):"change"==e?n.props.changeBook(n.state.input):"remove"==e&&n.props.removeBook()}),n.state={input:""},n.buttonPressThrottled=l()(n.buttonPress,500),n}var n,o,a;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&b(t,e)}(e,r.a.Component),n=e,(o=[{key:"componentDidMount",value:function(){this.props.userData?this.setState({input:this.props.userData.status}):this.setState({input:"plan-to-read"})}},{key:"render",value:function(){var t=this;if(this.props.blockButtons)return r.a.createElement("div",{className:"viewBookButtons"},"...");return r.a.createElement("div",{className:"viewBookButtons"},r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"viewBookStatusSelect"},r.a.createElement("select",{name:"status",value:this.state.input,onChange:this.handleInput,id:"viewBookStatusSelect"},["reading","plan-to-read","finished"].map(function(t,e){return r.a.createElement("option",{value:t,key:e},t)})),r.a.createElement("span",null,"v"))),t.props.userData?r.a.createElement(y,null,r.a.createElement("button",{"data-type":"change",onClick:t.buttonPressThrottled},"Change"),r.a.createElement("button",{"data-type":"remove",onClick:t.buttonPressThrottled},"Remove")):r.a.createElement("button",{"data-type":"add",onClick:t.buttonPressThrottled},"Add to list"))}}])&&f(n.prototype,o),a&&f(n,a),e}();function h(t){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function g(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function k(t){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function w(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function E(t,e){return(E=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function j(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.d(e,"default",function(){return B});var O=r.a.Fragment,B=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),n=function(t,e){return!e||"object"!==h(e)&&"function"!=typeof e?w(t):e}(this,k(e).call(this,t)),j(w(n),"updateView",function(){n.setState({display:"loading"}),i(n.abortController.signal,n.props.bookId,function(t,e){if(404===t||!e)return n.setState({display:"not found"});if(401===t)return n.context.setAppContext("authenticated",!1);var o=!0;if(!e.userData)o=!1;n.setState({display:"found",data:e,owned:o})})}),j(w(n),"addChangeDeleteCallback",function(t,e,o){if(t)return 401==t?n.context.setAppContext("authenticated",!1):500==t||400==t?n.setState({display:"error"}):n.setState({display:"not found"});n.setState(function(t){var n=t.data;return n.userData=e,console.log(n),{data:n,owned:o,blockButtons:!1}})}),j(w(n),"addBook",function(t){!function(t,e,n){u("POST",t,e,n)}(n.state.data.bookData.text_id,t,function(t,e){n.addChangeDeleteCallback(t,e,!0)})}),j(w(n),"changeBook",function(t){!function(t,e,n){u("PUT",t,e,n)}(n.state.data.bookData.text_id,t,function(t,e){n.addChangeDeleteCallback(t,e,!0)})}),j(w(n),"removeBook",function(){var t=n.state.data.bookData.text_id;u("DELETE",t,null,function(t,e){n.addChangeDeleteCallback(t,e,!1)})}),j(w(n),"turnOffButton",function(){n.setState({blockButtons:!0})}),n.state={display:"loading",data:null,owned:!1,blockButtons:!1},n.abortController=new AbortController,n}var n,o,a;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&E(t,e)}(e,r.a.Component),n=e,(o=[{key:"componentDidMount",value:function(){this.updateView()}},{key:"componentWillUnmount",value:function(){this.abortController.abort()}},{key:"componentDidUpdate",value:function(t){t.bookId!==this.props.bookId&&this.updateView()}},{key:"render",value:function(){if("found"===this.state.display){var t=this.state.data.bookData,e=this.state.data.userData,n=t.metadata,o="http://www.gutenberg.org/cache/epub/".concat(t.text_id,"/pg").concat(t.text_id,".cover.medium.jpg"),a="http://www.gutenberg.org/ebooks/".concat(t.text_id);return r.a.createElement(O,null,r.a.createElement("div",{className:"viewBookContainer"},r.a.createElement("a",{href:a,target:"_blank"},r.a.createElement("p",{className:"viewBookHeader"},n.title),r.a.createElement("div",{className:"viewBookThumbnail"},r.a.createElement("img",{src:o,alt:""}),r.a.createElement("span",null,n.title),function(){if(e)return r.a.createElement("div",null,e.status)}())),r.a.createElement(v,{owned:this.state.owned,userData:e,addBook:this.addBook,changeBook:this.changeBook,removeBook:this.removeBook,turnOffButton:this.turnOffButton,blockButtons:this.state.blockButtons}),r.a.createElement("div",{className:"viewBookInfo"},r.a.createElement("p",null,r.a.createElement("b",null,"Language:")," ",n.language),r.a.createElement("p",null,r.a.createElement("b",null,"Author:")," ",n.author),r.a.createElement("p",null,r.a.createElement("b",null,"Subject:")),function(){if(n.subject)return n.subject.map(function(t,e){return r.a.createElement("p",{key:e},t)})}())))}return"loading"===this.state.display?r.a.createElement("div",{className:"viewBookLoading"},r.a.createElement("p",null,"Getting book data...")):"not found"===this.state.display?r.a.createElement("div",{className:"viewBookLoading viewBookNotFound"},r.a.createElement("p",null,"Can't find a book with that id :(")):"error"===this.state.display?r.a.createElement("div",{className:"viewBookLoading viewBookError"},r.a.createElement("p",null,"This app just tripped on a rock and fall off a cliff :("),r.a.createElement("p",null,"Hit F5 button to revive it.")):void 0}}])&&g(n.prototype,o),a&&g(n,a),e}();j(B,"contextType",a.a)}}]);