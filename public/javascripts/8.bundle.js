(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{78:function(t,e,n){"use strict";n.r(e);var o=n(0),a=n.n(o),r=n(9);function i(t,e,n){!function(t,e,n){fetch("https://gutenberg.justamouse.com/texts/".concat(e),{signal:t}).then(function(t){return t.ok?t.json():Promise.reject(t.status)}).then(function(t){if(!t.metadata.title)return Promise.reject(404);n(null,t)}).catch(function(t){n(t,null)})}(t,e,function(o,a){if(o)return n(o,null);!function(t,e,n){fetch("/api/booklist/".concat(e),{credentials:"same-origin",signal:t}).then(function(t){return t.ok?t.json():Promise.reject(t.status)}).then(function(t){n(null,t)}).catch(function(t){n(t,null)})}(t,e,function(t,e){return n(null,{bookData:a,userData:e})})})}function u(t,e,n,o){var a={method:t,credentials:"same-origin"};"DELETE"!=t&&(a.headers={"Content-Type":"application/json"},a.body=JSON.stringify({status:n}));var r="/api/booklist/".concat(e);fetch(r,a).then(function(t){return t.ok?t.json():Promise.reject(t.status)}).then(function(t){return o(null,t)}).catch(function(t){return o(t,null)})}var l=n(59),c=n.n(l);function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function f(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function d(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function b(t,e){return(b=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function m(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var h=a.a.Fragment,y=function(t){function e(t){var n,o,a;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),o=this,a=p(e).call(this,t),n=!a||"object"!==s(a)&&"function"!=typeof a?d(o):a,m(d(n),"handleInput",function(t){n.setState({input:t.target.value})}),m(d(n),"buttonPress",function(t){var e=t.target.dataset.type;n.props.turnOffButton(),"add"==e?n.props.addBook(n.state.input):"change"==e?n.props.changeBook(n.state.input):"remove"==e&&n.props.removeBook()}),n.state={input:""},n.buttonPressThrottled=c()(n.buttonPress,500),n}var n,o,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&b(t,e)}(e,a.a.Component),n=e,(o=[{key:"componentDidMount",value:function(){this.props.userData?this.setState({input:this.props.userData.status}):this.setState({input:"plan-to-read"})}},{key:"render",value:function(){var t=this;if(this.props.blockButtons)return a.a.createElement("div",{className:"viewBookButtons"},"...");return a.a.createElement("div",{className:"viewBookButtons"},a.a.createElement("div",null,a.a.createElement("label",{htmlFor:"viewBookStatusSelect"},a.a.createElement("select",{name:"status",value:this.state.input,onChange:this.handleInput,id:"viewBookStatusSelect"},["reading","plan-to-read","finished"].map(function(t,e){return a.a.createElement("option",{value:t,key:e},t)})),a.a.createElement("span",null,"v"))),t.props.userData?a.a.createElement(h,null,a.a.createElement("button",{"data-type":"change",onClick:t.buttonPressThrottled},"Change"),a.a.createElement("button",{"data-type":"remove",onClick:t.buttonPressThrottled},"Remove")):a.a.createElement("button",{"data-type":"add",onClick:t.buttonPressThrottled},"Add to list"))}}])&&f(n.prototype,o),r&&f(n,r),e}();function v(t){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function k(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function g(t){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function w(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function E(t,e){return(E=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function B(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.d(e,"default",function(){return S});var j=a.a.Fragment,S=function(t){function e(t){var n,o,a;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),o=this,a=g(e).call(this,t),n=!a||"object"!==v(a)&&"function"!=typeof a?w(o):a,B(w(n),"updateView",function(){n.setState({display:"loading"}),i(n.abortController.signal,n.props.bookId,function(t,e){if(404===t||!e)return n.setState({display:"not found"});if(401===t)return n.context.setAppContext("authenticated",!1);var o=!0;if(!e.userData)o=!1;n.setState({display:"found",data:e,owned:o})})}),B(w(n),"addChangeDeleteCallback",function(t,e,o){if(t)return 401==t?n.context.setAppContext("authenticated",!1):500==t||400==t?n.setState({display:"error"}):n.setState({display:"not found"});n.setState(function(t){var n=t.data;return n.userData=e,console.log(n),{data:n,owned:o,blockButtons:!1}})}),B(w(n),"addBook",function(t){!function(t,e,n){u("POST",t,e,n)}(n.state.data.bookData.text_id,t,function(t,e){n.addChangeDeleteCallback(t,e,!0)})}),B(w(n),"changeBook",function(t){!function(t,e,n){u("PUT",t,e,n)}(n.state.data.bookData.text_id,t,function(t,e){n.addChangeDeleteCallback(t,e,!0)})}),B(w(n),"removeBook",function(){var t=n.state.data.bookData.text_id;u("DELETE",t,null,function(t,e){n.addChangeDeleteCallback(t,e,!1)})}),B(w(n),"turnOffButton",function(){n.setState({blockButtons:!0})}),n.state={display:"loading",data:null,owned:!1,blockButtons:!1},n.abortController=new AbortController,n}var n,o,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&E(t,e)}(e,a.a.Component),n=e,(o=[{key:"componentDidMount",value:function(){this.updateView()}},{key:"componentWillUnmount",value:function(){this.abortController.abort()}},{key:"componentDidUpdate",value:function(t){t.bookId!==this.props.bookId&&this.updateView()}},{key:"render",value:function(){if("found"===this.state.display){var t=this.state.data.bookData,e=this.state.data.userData,n=t.metadata,o="http://www.gutenberg.org/cache/epub/".concat(t.text_id,"/pg").concat(t.text_id,".cover.medium.jpg"),r="http://www.gutenberg.org/ebooks/".concat(t.text_id);return a.a.createElement(j,null,a.a.createElement("div",{className:"viewBookContainer"},a.a.createElement("a",{href:r,target:"_blank"},a.a.createElement("p",{className:"viewBookHeader"},n.title),a.a.createElement("div",{className:"viewBookThumbnail"},a.a.createElement("img",{src:o,alt:""}),a.a.createElement("span",null,n.title),function(){if(e)return a.a.createElement("div",null,e.status)}())),a.a.createElement(y,{owned:this.state.owned,userData:e,addBook:this.addBook,changeBook:this.changeBook,removeBook:this.removeBook,turnOffButton:this.turnOffButton,blockButtons:this.state.blockButtons}),a.a.createElement("div",{className:"viewBookInfo"},a.a.createElement("p",null,a.a.createElement("b",null,"Language:")," ",n.language),a.a.createElement("p",null,a.a.createElement("b",null,"Author:")," ",n.author),a.a.createElement("p",null,a.a.createElement("b",null,"Subject:")),function(){if(n.subject)return n.subject.map(function(t,e){return a.a.createElement("p",{key:e},t)})}())))}return"loading"===this.state.display?a.a.createElement("div",{className:"viewBookLoading"},a.a.createElement("p",null,"Getting book data...")):"not found"===this.state.display?a.a.createElement("div",{className:"viewBookLoading viewBookNotFound"},a.a.createElement("p",null,"Can't find a book with that id :(")):"error"===this.state.display?a.a.createElement("div",{className:"viewBookLoading viewBookError"},a.a.createElement("p",null,"This app just tripped on a rock and fall off a cliff :("),a.a.createElement("p",null,"Hit F5 button to revive it.")):void 0}}])&&k(n.prototype,o),r&&k(n,r),e}();B(S,"contextType",r.a)}}]);